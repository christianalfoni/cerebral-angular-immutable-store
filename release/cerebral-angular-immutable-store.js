!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("angular")):"function"==typeof define&&define.amd?define(["angular"],t):"object"==typeof exports?exports.Cerebral=t(require("angular")):e.Cerebral=t(e.angular)}(this,function(e){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){(function(t){var r=n(9),i=t.angular||n(15),o=n(10),s=n(13).EventEmitter,a=r.Value,u=function(e,t){var n=new s,i=o(e);e=i;var u=r.Controller({defaultArgs:t,onReset:function(){e=i},onSeek:function(t,r,i){e=e["import"](i.initialState),n.emit("change",e)},onUpdate:function(){n.emit("change",e)},onGet:function(t){return a(t,e)},onSet:function(t,n){var r=t.pop();e=a(t,e).set(r,n)},onUnset:function(t,n){e=a(t,e).unset(n)},onPush:function(t,n){e=a(t,e).push(n)},onSplice:function(){var t=[].slice.call(arguments),n=a(t.shift(),e);e=n.splice.apply(n,t)},onMerge:function(t,n){e=a(t,e).merge(n)},onConcat:function(){var t=[].slice.call(arguments),n=a(t.shift(),e);e=n.concat.apply(n,t)},onPop:function(t){e=a(t,e).pop()},onShift:function(t,n){e=a(t,e).shift(n)},onUnshift:function(t){e=a(t,e).unshift()}});return u.injectState=function(t,r){var i=function(n){Object.keys(r).forEach(function(i){t[i]=a(r[i],n||e)}),n&&t.$apply()};t.$on("$destroy",function(){n.off("change",i)}),n.on("change",i),i()},u};i.module("cerebral",[]).provider("cerebral",function(){var e={},t={};this.setState=function(t){e=t},this.setDefaultArgs=function(e){t=e},this.$get=function(){return new u(e,t)}}),e.exports=i}).call(t,function(){return this}())},function(e,t){(function(t){e.exports={getFunctionName:function(e){var t=e.toString();return t=t.substr("function ".length),t=t.substr(0,t.indexOf("("))},merge:function(e,t){return t=t||{},Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},hasLocalStorage:function(){return"undefined"!=typeof t.localStorage},isPathObject:function(e){return e&&(e.resolve||e.reject)}}}).call(t,function(){return this}())},function(e,t){"use strict";var n={toJS:function(e){return e instanceof Array?e.map(function(e){return n.toJS(e)}):"object"==typeof e&&null!==e?Object.keys(e).reduce(function(t,r){return t[r]=n.toJS(e[r]),t},{}):e},"export":function(e,t){return e instanceof Array?e.map(function(e){return n["export"](e,t)}):"object"==typeof e&&null!==e?Object.keys(e).reduce(function(r,i){return e.__&&t.get(e,i)?r[i]=t.get(e,i).value:r[i]=n["export"](e[i],t),r},{}):e},"import":function(e,t,r){return Object.keys(e).reduce(function(i,o){if(e[o]instanceof Array||"object"!=typeof e[o]||null===e[o]||!n.getByPath(i,r))return n.getByPath(i,r).set(o,e[o]);r.push(o);var s=n["import"](e[o],t,r);return r.pop(),s},t.currentStore)},getByPath:function(e,t){return t.reduce(function(e,t){return e[t]},e)},isSame:function(e,t){return Object.keys(e).reduce(function(n,r){return n?e[r]===t[r]:!1},!0)}};e.exports=n},function(e,t,n){var r=n(2);e.exports=function(e){var t={};return{set:function(n,i,o,s){t[n.__.path.slice().concat(i).join("")]=o;var a=o.value,u=null,c=null,l=e.currentStore,f=function(){return Object.keys(o.deps).reduce(function(t,n){return t[n]=r.getByPath(e.currentStore,o.deps[n]),t},{})},p=function(){var e=f();return r.isSame(e,c)};Object.defineProperty(n,i,{get:function(){return s&&(e.currentStore=s),l!==e.currentStore?(c=f(),o.get(a,c)):c&&p()?u=o.get(a,c):c?u:(c=f(),o.get(a,c))},set:function(e){a=e,o.value=e},enumerable:!0,configurable:!0})},get:function(e,n){return t[e.__.path.slice().concat(n).join("")]}}}},function(e,t,n){n(1);e.exports=function(e,t,n){var r=null,i=null,o=[],s=0,a=null,u=null,c=!1,l=!1,f=!1,p=0;return{seek:function(s,u){if(clearTimeout(i),o.forEach(clearTimeout),n.onSeek&&n.onSeek(s,!!u,r),!e.isRemembering()){var l=function(e){for(var n=e.name.split("."),r=t;n.length;)r=r[n.shift()];r.call(null,e.payload,e.asyncActionResults.slice())},p=r.signals.filter(function(e){return e.start-r.start<s});if(f=!0,p.forEach(l),f=!1,u){this.createTimer();for(var h=r.signals.length,g=p.length,v=g;h>v;v++){var m=r.signals[v],d=m.start-r.start-s;o.push(setTimeout(l.bind(null,m),d))}c=!0,a=Date.now()}o.push(setTimeout(function(){c=!1,n.onUpdate&&n.onUpdate()},r.end-r.start-s)),n.onUpdate&&n.onUpdate()}},createTimer:function(){var e=function(){s+=500,n.onDurationChange&&n.onDurationChange(s),s<r.duration&&(i=setTimeout(e,500),n.onUpdate&&n.onUpdate())}.bind(this);i=setTimeout(e,500)},resetState:function(){n.onRecorderReset&&n.onRecorderReset(r.initialState)},record:function(t,i){e.isRemembering()||(r&&this.resetState(),r={initialState:t,start:Date.now(),signals:[],meta:i},l=!0,n.onUpdate&&n.onUpdate())},stop:function(){var t=c;if(clearTimeout(i),c=!1,l=!1,!e.isRemembering()&&!t){if(e.isExecutingAsync())throw new Error("Cerebral - You can not stop when async signals are running, make sure to handle that with: cerebral.hasExecutingSignal()");r.end=Date.now(),r.duration=r.end-r.start,n.onUpdate&&n.onUpdate()}},pause:function(){if(e.isExecutingAsync())throw new Error("Cerebral - You can not stop when async signals are running, make sure to handle that with: cerebral.hasExecutingSignal()");e.isRemembering()||(u=Date.now(),p=u-a,clearTimeout(i),o.forEach(clearTimeout),n.onUpdate&&n.onUpdate())},addSignal:function(e){r.signals.push(e)},isRecording:function(){return l},isPlaying:function(){return c},isCatchingUp:function(){return f},getRecording:function(){return r},getCurrentSeek:function(){return p}}}},function(e,t,n){(function(t){var r=n(1),i=n(8),o=[],s=!1,a=t.requestAnimationFrame||function(e){setTimeout(e,0)};e.exports=function(e,t,n,u){return function(){var c=[].slice.call(arguments),l=c.shift(),f=c;return function(c,p){var h=f.slice(),g=function(){var o=r.merge(c||{},u.defaultArgs||{}),s={name:l,actions:[],duration:0,start:Date.now(),payload:c,asyncActionResults:[]};t.isRecording()&&t.addSignal(s),e.addSignal(s);var a=function(){if(h.length){var c=h.shift();if(Array.isArray(c)){var l=c,f=l.filter(function(e){return"function"==typeof e}),g=l[l.length-1];e.isRemembering()||t.isPlaying()?(d=p.shift(),r.merge(o,d.result),r.isPathObject(g)&&(d.resolved?g.resolve:g.reject)&&h.splice.apply(h,[0,0].concat(d.resolved?g.resolve:g.reject)),a()):(u.onUpdate&&u.onUpdate(),e.addAsyncAction(),Promise.all(f.map(function(e){var t=i.async(s.actions,o,u),n={name:r.getFunctionName(e),isParallell:f.length>1,duration:0,mutations:[],isAsync:!0};return s.actions.push(n),new Promise(function(n,r){e.apply(null,t.concat({resolve:n,reject:r}))})})).then(function(t){var n=t.reduce(function(e,t){return r.merge(e,t),e},{});e.removeAsyncAction(),s.asyncActionResults.push({resolved:!0,result:n}),r.merge(o,n),r.isPathObject(g)&&g.resolve&&h.splice.apply(h,[0,0].concat(g.resolve)),a()})["catch"](function(t){e.removeAsyncAction(),s.asyncActionResults.push({resolved:!1,result:t}),r.merge(o,t),r.isPathObject(g)&&g.reject&&h.splice.apply(h,[0,0].concat(g.reject)),a()}),n&&n.update())}else{var v=i.sync(s.actions,o,u),m={name:r.getFunctionName(c),duration:0,isParallell:!1,mutations:[],isAsync:!1};s.actions.push(m);var d=c.apply(null,v);r.merge(o,d),a()}}else e.isRemembering()||t.isCatchingUp()||(u.onUpdate&&u.onUpdate(),n&&n.update())};a()};e.isRemembering()||t.isCatchingUp()?g():(o.push(g),s||(a(function(){for(;o.length;)o.shift()();s=!1}),s=!0))}}}}).call(t,function(){return this}())},function(e,t,n){(function(t){var r=n(1);e.exports=function(e,n){var i=r.hasLocalStorage()&&localStorage.getItem("cerebral_signals")?JSON.parse(localStorage.getItem("cerebral_signals")):[],o="production"===t.env.NODE_ENV?!1:r.hasLocalStorage()&&localStorage.getItem("cerebral_willKeepState")?JSON.parse(localStorage.getItem("cerebral_willKeepState")):!1,s=0,a=!1,u=i.length-1;return{toggleKeepState:function(){o=!o},addAsyncAction:function(){s++},removeAsyncAction:function(){s--},addSignal:function(e){u++,a||(o||(i=[],u=0),u<i.length&&i.splice(u,i.length-u),i.push(e))},rememberNow:function(){i.length&&this.remember(i.length-1)},reset:function(){a||(i=[],u=-1,n.onReset&&n.onReset())},remember:function(t){if(a=!0,n.onReset&&n.onReset(),-1===t)u=t,a=!1;else{u=-1;for(var r=0;t>=r;r++){var o=i[r];if(!o)break;for(var s=o.name.split("."),c=e;s.length;)c=c[s.shift()];c.call(null,o.payload,o.asyncActionResults.slice()),u=r}}a=!1,n.onUpdate&&n.onUpdate()},getSignals:function(){return i},isExecutingAsync:function(){return!!s},isRemembering:function(){return a},willKeepState:function(){return o},getCurrentIndex:function(){return u}}}}).call(t,n(14))},function(e,t,n){var r=n(1);e.exports=function(e,t){var n=function(){return{state:t.onGet([]),props:{signals:e.getSignals(),willKeepState:e.willKeepState(),currentSignalIndex:e.getCurrentIndex(),isExecutingAsync:e.isExecutingAsync(),isRemembering:e.isRemembering()}}},i=function(e){var t=new CustomEvent(e||"cerebral.dev.update",{detail:n()});window.dispatchEvent(t)};return window.addEventListener("cerebral.dev.initialize",function(){e.remember(e.getSignals().length-1),i("cerebral.dev.initialized")}),i("cerebral.dev.initialized"),window.addEventListener("cerebral.dev.toggleKeepState",function(){e.toggleKeepState(),i()}),window.addEventListener("cerebral.dev.toggleStoreState",function(){e.toggleStoreState(),i()}),window.addEventListener("cerebral.dev.resetStore",function(){e.reset(),i()}),window.addEventListener("cerebral.dev.remember",function(t){e.remember(t.detail),i()}),window.addEventListener("cerebral.dev.logPath",function(e){var n=e.detail.name,r=t.onGet(e.detail.path);console.log("CEREBRAL - "+n+":",r.toJS?r.toJS():r)}),window.addEventListener("unload",function(){r.hasLocalStorage()&&localStorage.setItem("cerebral_signals",JSON.stringify(e.getSignals())),r.hasLocalStorage()&&localStorage.setItem("cerebral_willKeepState",JSON.stringify(e.willKeepState()))}),{update:i}}},function(e,t){var n=function(e,t){return function(n,r){return n[r.toLowerCase()]=function(){if("Get"===r){var n="string"==typeof arguments[0]?[].slice.call(arguments):arguments[0];return t.onGet&&t.onGet(n)}var n=1===arguments.length?[]:"string"==typeof arguments[0]?[arguments[0]]:arguments[0],i=1===arguments.length?[].slice.call(arguments):[].slice.call(arguments).splice(1);return e[e.length-1].mutations.push({name:r.toLowerCase(),path:n.slice(),args:i}),t["on"+r]&&t["on"+r].apply(null,[n].concat(i))},n}};e.exports={sync:function(e,t,r){return[t,["Get","Set","Unset","Push","Concat","Shift","Unshift","Merge","Splice","Pop"].reduce(n(e,r),{})]},async:function(e,t,r){return[t,["Get"].reduce(n(e,r),{})]}}},function(e,t,n){var r=n(5),i=n(6),o=n(4),s=n(7);e.exports={Controller:function(e){e=e||{};var t={},n=i(t,e);if("undefined"!=typeof window)var a=s(n,e);var u=o(n,t,e),c=r(n,u,a,e);return{signal:function(){t[arguments[0]]=c.apply(null,arguments)},signals:t,store:n,recorder:u,get:function(){var t="string"==typeof arguments[0]?[].slice.call(arguments):arguments[0];return e.onGet(t)}}},Value:function(e,t){for(e=e.slice();e.length;)t=t[e.shift()];return t}}},function(e,t,n){"use strict";function r(e){if(!e||"object"!=typeof e||Array.isArray(e)||null===e)throw new Error("You have to pass an object to the store");var t={currentPath:[],currentStore:null,mapper:null,update:function(e,n){return t.currentStore=l(t,e,n),t.currentStore},updateMapping:function(e,n,r){return t.currentStore=l(t,e,function(e,t,i){t.mapper.set(e,n,t.mapper.get(e,n)),t.currentPath.push(n),e[n]=r,t.currentPath.pop()}),t.currentStore}};return t.mapper=s(t),t.currentStore=f(t,e),t.currentStore}var i=n(11),o=n(12),s=n(3),a=n(2),u=function(e,t){return Array.isArray(e)?i(e,t):"object"==typeof e&&null!==e?o(e,t):e},c=function(e,t){if(Array.isArray(t)&&!t.__){var n=t.map(function(t,n){e.currentPath.push(n);var r=c(e,t);return e.currentPath.pop(),r}),r=i(n,e);return Object.freeze(r),r}if("object"!=typeof t||null===t||t.__)return t;var s=Object.keys(t).reduce(function(n,r){return e.currentPath.push(r),n[r]=c(e,t[r]),e.currentPath.pop(),n},{}),a=o(s,e);return Object.freeze(a),a},l=function(e,t,n){e.currentPath=[];var r=t.__.path;r.length||(e.currentStore=t);var i=u(e.currentStore,e),s=i;r.forEach(function(t){e.currentPath.push(t),s[t]=u(s[t],e),s=s[t]}),n(s,e,c),s=i,r.forEach(function(t){s=s[t],Object.freeze(s),e.currentPath.pop()});var l=o(i,e);return Object.keys(i).forEach(function(t){var n=Object.getOwnPropertyDescriptor(i,t);n&&n.get&&n.set?Object.defineProperty(l,t,{get:function(){return e.currentStore=this,n.get()}}):Object.defineProperty(l,t,{enumerable:!0,get:function(){return e.currentStore=this,i[t]}})}),Object.defineProperty(l,"export",{enumerable:!1,value:function(){return a["export"](l,e.mapper)}}),Object.defineProperty(l,"import",{enumerable:!1,value:function(t){return a["import"](t,e,[])}}),Object.freeze(l),l},f=function(e,t){var n=o({},e);return Object.keys(t).forEach(function(r){e.currentPath.push(r);var i=c(e,t[r]);e.currentPath.pop(r),"function"==typeof t[r]?e.mapper.set(n,r,t[r](),n):Object.defineProperty(n,r,{enumerable:!0,get:function(){return e.currentStore=this,i}})}),Object.defineProperty(n,"export",{enumerable:!1,value:function(){return a["export"](n,e.mapper)}}),Object.defineProperty(n,"import",{enumerable:!1,value:function(t){return a["import"](t,e,[])}}),Object.freeze(n),n};e.exports=r},function(e,t,n){"use strict";var r=n(2),i=function(){function e(t){var n=Array.apply(Array);return n=n.concat(t),n.__proto__=e.prototype,n}return e.prototype=Object.create(Array.prototype),e.prototype.push=function(e){return this.__.update(this,function(t,n,r){n.currentPath.push(t.length),Array.prototype.push.call(t,r(n,e)),n.currentPath.pop()})},e.prototype.splice=function(){var e=[].slice.call(arguments,0),t=e.shift(),n=e.shift();return this.__.update(this,function(r,i,o){var s=e.map(function(e,n){i.currentPath.push(t+n);var r=o(i,e);return i.currentPath.pop(),r});Array.prototype.splice.apply(r,[t,n].concat(s));for(var a=t;a<r.length;a++)if(r[a].__){var u=r[a].__.path;u[u.length-1]=a}})},e.prototype.concat=function(){var e=[].slice.call(arguments,0);return this.__.update(this,function(t,n,r){e.map(function(e){Array.isArray(e)?e.map(function(e){n.currentPath.push(t.length),Array.prototype.push.call(t,r(n,e)),n.currentPath.pop()}):(n.currentPath.push(t.length),Array.prototype.push.call(t,r(n,e)),n.currentPath.pop())})})},e.prototype.unshift=function(e){return this.__.update(this,function(t,n,r){Array.prototype.unshift.call(t,r(n,e));for(var i=0;i<t.length;i++)if(t[i].__){var o=t[i].__.path;o[o.length-1]=i}})},e.prototype.shift=function(){return this.__.update(this,function(e,t,n){Array.prototype.shift.call(e);for(var r=0;r<e.length;r++)if(e[r].__){var i=e[r].__.path;i[i.length-1]=r}})},e.prototype.pop=function(){return this.__.update(this,function(e){Array.prototype.pop.call(e)})},e.prototype.toJS=function(){return r.toJS(this)},function(t,n){var r=new e(t);return Object.defineProperty(r,"__",{value:{path:n.currentPath.slice(0),update:n.update}}),r}};e.exports=i()},function(e,t,n){"use strict";var r=n(2),i=(n(3),function(){var e={set:function(e,t){return this.__.update(this,function(n,r,i){Array.isArray(t)&&t.forEach(function(e,t){e.__&&(e.__.path[e.__.path.length-1]=t)}),r.currentPath.push(e),n[e]=i(r,t),r.currentPath.pop()})},toJS:function(){return r.toJS(this)},merge:function(e){if(Array.isArray(e)||"object"!=typeof e||null===e)throw new Error("You have to pass an object to the merge method");return this.__.update(this,function(t,n,r){Object.keys(e).forEach(function(i){n.currentPath.push(i),t[i]=r(n,e[i]),n.currentPath.pop()})})},unset:function(e){return this.__.update(this,function(t){delete t[e]})}};return function(t,n){var r=Object.create(e);return Object.defineProperty(r,"__",{value:{path:n.currentPath.slice(0),update:n.update,updateMapping:n.updateMapping}}),Object.keys(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e);i&&i.get&&i.set?n.mapper.set(r,e,n.mapper.get(r,e)):"function"==typeof t[e]?n.mapper.set(r,e,t[e]()):r[e]=t[e]}),r}});e.exports=i()},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,a=new Array(i-1),u=1;i>u;u++)a[u-1]=arguments[u];n.apply(this,a)}else if(o(n)){for(i=arguments.length,a=new Array(i-1),u=1;i>u;u++)a[u-1]=arguments[u];for(c=n.slice(),i=c.length,u=0;i>u;u++)c[u].apply(this,a)}return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned){var i;i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-->0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},function(e,t){function n(){c=!1,s.length?u=s.concat(u):l=-1,u.length&&r()}function r(){if(!c){var e=setTimeout(n);c=!0;for(var t=u.length;t;){for(s=u,u=[];++l<t;)s[l].run();l=-1,t=u.length}s=null,c=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function o(){}var s,a=e.exports={},u=[],c=!1,l=-1;a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new i(e,t)),1!==u.length||c||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=o,a.addListener=o,a.once=o,a.off=o,a.removeListener=o,a.removeAllListeners=o,a.emit=o,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,n){t.exports=e}])});